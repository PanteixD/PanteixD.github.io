<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doodle Book Clone - New Combo Structure</title>
    <style>
        /* CSS remains the same */
        :root { --parchment-bg: #f5e8c9; --book-border: #8a6a4a; --text-color: #4a3a2a; --icon-size: 55px; --slot-size: 70px; --selected-glow: 0 0 10px 3px #4a90e2; --hint-glow: 0 0 10px 3px #ffcc00; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #2a5a7a; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 10px; box-sizing: border-box; color: var(--text-color); user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; }
        #book { display: flex; width: 98%; max-width: 1150px; height: 90vh; background-color: var(--parchment-bg); border: 5px solid var(--book-border); border-radius: 10px; box-shadow: 10px 10px 20px rgba(0,0,0,0.5); position: relative; }
        #book::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 15px; background: linear-gradient(to right, rgba(0,0,0,0.2), rgba(0,0,0,0), rgba(0,0,0,0.2)); transform: translateX(-50%); z-index: 1; }
        .page { flex: 1; padding: 20px; box-sizing: border-box; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        #left-page { border-right: 1px dashed rgba(0,0,0,0.2); align-items: center; justify-content: space-between; padding-bottom: 30px; }
        #right-page { overflow-y: auto; }
        #combination-section { width: 100%; text-align: center; padding-top: 10px; }
        #combination-area { text-align: center; margin-bottom: 15px; }
        #combination-slots { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 15px 0; min-height: calc(var(--slot-size) + 10px); }
        .slot { width: var(--slot-size); height: var(--slot-size); border: 3px dashed var(--book-border); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8em; color: #aaa; background-color: rgba(255, 255, 255, 0.3); position: relative; transition: background-color 0.2s, border-color 0.2s; overflow: hidden; line-height: var(--slot-size); text-align: center; }
        .slot.filled { border-style: solid; border-color: var(--book-border); background-color: #fff; color: var(--text-color); }
        .slot .element-name { display: none; }
        #feedback { margin-top: 10px; padding: 8px 12px; background-color: rgba(255, 255, 255, 0.4); border: 1px solid transparent; border-radius: 4px; min-height: 18px; width: 90%; max-width: 350px; margin-left: auto; margin-right: auto; text-align: center; font-weight: bold; font-size: 0.9em; transition: background-color 0.3s, color 0.3s; }
        #feedback.success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        #feedback.fail { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        #feedback.hint { background-color: #fff3cd; border-color: #ffeeba; color: #856404; }
        #controls { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .action-button { padding: 6px 12px; cursor: pointer; border: 2px solid var(--book-border); border-radius: 20px; background-color: #eee; color: var(--text-color); font-weight: bold; font-size: 0.9em; transition: background-color 0.2s, transform 0.1s; }
        .action-button:hover { background-color: #ddd; }
        .action-button:active { transform: scale(0.95); }
        #hint-button { background-color: #fffacd; }
        #hint-button:hover { background-color: #fff0a0; }
        #left-page-decoration { flex-grow: 1; display: flex; align-items: center; justify-content: center; opacity: 0.1; padding: 10px 0; min-height: 100px; }
        #left-page-decoration svg { width: 50%; height: auto; max-width: 150px; }
        #inventory-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid var(--book-border); }
        #inventory-header h2 { margin: 0; font-size: 1.3em; }
        #progress-counter { font-weight: bold; font-size: 0.9em; color: #6a4a2a; }
        #search-bar { width: calc(100% - 16px); padding: 6px 8px; margin-bottom: 10px; border: 1px solid var(--book-border); border-radius: 4px; font-size: 0.9em; background-color: #fff; color: var(--text-color); }
        #search-bar:focus { outline: none; border-color: #6a4a2a; box-shadow: 0 0 5px rgba(138, 106, 74, 0.5); }
        #elements-list { /* Takes remaining space */ }
        .element-group h3 { margin-top: 15px; margin-bottom: 8px; padding-bottom: 3px; border-bottom: 1px dotted var(--book-border); font-size: 1em; color: #6a4a2a; text-transform: uppercase; letter-spacing: 1px; }
        .element-group:first-child h3 { margin-top: 0; }
        .elements-in-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .element-icon { width: var(--icon-size); height: var(--icon-size); border: 2px solid var(--book-border); border-radius: 50%; background-color: #fff; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; position: relative; transition: transform 0.1s, box-shadow 0.2s, border-color 0.2s; overflow: hidden; }
        .element-icon:hover { transform: scale(1.05); box-shadow: 0 0 8px rgba(0,0,0,0.3); }
        .element-icon .icon-display { font-size: 1.6em; line-height: 1; margin-bottom: 2px; }
        .element-icon .icon-name { font-size: 0.6em; line-height: 1; color: var(--text-color); max-width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .element-icon.selected { box-shadow: var(--selected-glow); border-color: #4a90e2; }
        .element-icon.hint-active { box-shadow: var(--hint-glow); border-color: #ffcc00; animation: pulse-hint 1s infinite alternate; }
        @keyframes pulse-hint { from { transform: scale(1); } to { transform: scale(1.05); } }
        .element-icon[data-id="fire"] { background-color: #ffac8f; border-color: #e04a1a; }
        .element-icon[data-id="water"] { background-color: #a3d5ff; border-color: #3498db; }
        .element-icon[data-id="earth"] { background-color: #c4a484; border-color: #8b4513; }
        .element-icon[data-id="air"] { background-color: #e6f7ff; border-color: #a0d3e8; }
        #right-page::-webkit-scrollbar { width: 10px; }
        #right-page::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 5px; }
        #right-page::-webkit-scrollbar-thumb { background: var(--book-border); border-radius: 5px; }
        #right-page::-webkit-scrollbar-thumb:hover { background: #6a4a2a; }
    </style>
</head>
<body>

    <div id="book">
        <!-- Left Page (Combination) -->
        <div id="left-page" class="page">
            <div id="combination-section">
                <h2>Combine Elements</h2>
                <div id="combination-area">
                    <div id="combination-slots">
                        <div id="slot1" class="slot">?</div>
                        <div id="slot2" class="slot">?</div>
                    </div>
                    <div id="feedback">Select two elements to combine.</div>
                    <div id="controls">
                        <button id="hint-button" class="action-button">Hint</button>
                        <button id="reset-button" class="action-button">Clear</button>
                    </div>
                </div>
            </div>
            <div id="left-page-decoration">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-14h2v6h-2zm0 8h2v2h-2z"/></svg>
            </div>
        </div>

        <!-- Right Page (Inventory) -->
        <div id="right-page" class="page">
            <div id="inventory-header">
                <h2>Element Inventory</h2>
                <span id="progress-counter">0/0</span>
            </div>
            <input type="search" id="search-bar" placeholder="Search elements..." autocomplete="off">
            <div id="elements-list">
                <!-- Element groups and icons will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // --- Game Data ---
        const ALL_ELEMENTS = {
            // Contains all element definitions (same as previous version)
            // Basic (4)
            'fire':  { name: 'Fire',  group: 'Basic', icon: 'üî•' }, 'water': { name: 'Water', group: 'Basic', icon: 'üíß' }, 'earth': { name: 'Earth', group: 'Basic', icon: 'üåç' }, 'air':   { name: 'Air',   group: 'Basic', icon: 'üí®' },
            // Natural & Weather (23)
            'steam': { name: 'Steam', group: 'Natural', icon: '‚òÅÔ∏è' }, 'lava':  { name: 'Lava',  group: 'Natural', icon: 'üåã' }, 'energy':{ name: 'Energy',group: 'Natural', icon: '‚ö°' }, 'dust':  { name: 'Dust',  group: 'Natural', icon: '‚ú®' }, 'mud':   { name: 'Mud',   group: 'Natural', icon: 'üü§' }, 'rain':  { name: 'Rain', group: 'Weather', icon: 'üåßÔ∏è'}, 'stone': { name: 'Stone', group: 'Natural', icon: 'üóø' }, 'sand':  { name: 'Sand', group: 'Natural', icon: '‚è≥' }, 'storm': { name: 'Storm', group: 'Weather', icon: '‚õàÔ∏è'}, 'volcano': { name: 'Volcano', group: 'Natural', icon: 'üåã' }, 'clay': { name: 'Clay', group: 'Natural', icon: 'üè∫' }, 'coal': { name: 'Coal', group: 'Natural', icon: '‚ö´' }, 'oil': { name: 'Oil', group: 'Natural', icon: '‚ö´' }, 'swamp': { name: 'Swamp', group: 'Natural', icon: 'üêä' }, 'geyser': { name: 'Geyser', group: 'Natural', icon: '‚ô®Ô∏è' }, 'ice': { name: 'Ice', group: 'Weather', icon: 'üßä' }, 'snow': { name: 'Snow', group: 'Weather', icon: '‚ùÑÔ∏è' }, 'wind': { name: 'Wind', group: 'Weather', icon: 'üå¨Ô∏è' }, 'cloud': { name: 'Cloud', group: 'Weather', icon: '‚òÅÔ∏è' }, 'sky': { name: 'Sky', group: 'Weather', icon: '‚òÄÔ∏è' }, 'sea': { name: 'Sea', group: 'Natural', icon: 'üåä' }, 'wave': { name: 'Wave', group: 'Natural', icon: 'üåä' }, 'sun': { name: 'Sun', group: 'Natural', icon: '‚òÄÔ∏è' }, 'cold': { name: 'Cold', group: 'Weather', icon: 'ü•∂' }, 'moon': { name: 'Moon', group: 'Natural', icon: 'üåô' }, 'star': { name: 'Star', group: 'Natural', icon: '‚≠ê' }, 'night': { name: 'Night', group: 'Weather', icon: 'üåÉ' }, 'shell': { name: 'Shell', group: 'Natural', icon: 'üêö' }, 'silicon': { name: 'Silicon', group: 'Materials', icon: '‚ú®' },
             // Life & Organic (26)
            'plant': { name: 'Plant', group: 'Life', icon: 'üå±' }, 'life':  { name: 'Life',  group: 'Life', icon: 'üß¨' }, 'seeds': { name: 'Seeds', group: 'Life', icon: 'üå∞' }, 'tree': { name: 'Tree', group: 'Life', icon: 'üå≥' }, 'human': { name: 'Human', group: 'Life', icon: 'üö∂' }, 'bacteria': { name: 'Bacteria', group: 'Life', icon: 'ü¶†' }, 'plankton': { name: 'Plankton', group: 'Life', icon: 'ü¶ê' }, 'fish': { name: 'Fish', group: 'Life', icon: 'üê†' }, 'bird': { name: 'Bird', group: 'Life', icon: 'üê¶' }, 'animal': { name: 'Animal', group: 'Life', icon: 'üêæ' }, 'flower': { name: 'Flower', group: 'Life', icon: 'üå∏' }, 'grass': { name: 'Grass', group: 'Life', icon: 'üåø' }, 'moss': { name: 'Moss', group: 'Life', icon: 'üå≤' }, 'mushroom': { name: 'Mushroom', group: 'Life', icon: 'üçÑ' }, 'worm': { name: 'Worm', group: 'Life', icon: 'üêõ' }, 'beetle': { name: 'Beetle', group: 'Life', icon: 'üêû' }, 'lizard': { name: 'Lizard', group: 'Life', icon: 'ü¶é' }, 'egg': { name: 'Egg', group: 'Life', icon: 'ü•ö' }, 'dna': { name: 'DNA', group: 'Life', icon: 'üß¨' }, 'feather': { name: 'Feather', group: 'Life', icon: 'ü™∂' }, 'phoenix': { name: 'Phoenix', group: 'Magic', icon: 'üê¶' }, 'ent': { name: 'Ent', group: 'Magic', icon: 'üå≥' }, 'butterfly': { name: 'Butterfly', group: 'Life', icon: 'ü¶ã' }, 'whale': { name: 'Whale', group: 'Life', icon: 'üê≥' }, 'cow': { name: 'Cow', group: 'Life', icon: 'üêÑ' }, 'reed': { name: 'Reed', group: 'Life', icon: 'üéã' }, 'livestock': { name: 'Livestock', group: 'Life', icon: 'üêë' },
            // Materials & Tools (35)
            'metal': { name: 'Metal', group: 'Materials', icon: '‚öôÔ∏è' }, 'glass': { name: 'Glass', group: 'Materials', icon: 'üç∏' }, 'pottery': { name: 'Pottery', group: 'Materials', icon: 'üè∫' }, 'bricks': { name: 'Bricks', group: 'Materials', icon: 'üß±' }, 'wood': { name: 'Wood', group: 'Materials', icon: 'ü™µ' }, 'fabric': { name: 'Fabric', group: 'Materials', icon: 'üßµ' }, 'paper': { name: 'Paper', group: 'Materials', icon: 'üìÑ' }, 'tools': { name: 'Tools', group: 'Tools', icon: 'üõ†Ô∏è' }, 'weapon': { name: 'Weapon', group: 'Tools', icon: '‚öîÔ∏è' }, 'knife': { name: 'Knife', group: 'Tools', icon: 'üî™' }, 'axe': { name: 'Axe', group: 'Tools', icon: 'ü™ì' }, 'hammer': { name: 'Hammer', group: 'Tools', icon: 'üî®' }, 'plow': { name: 'Plow', group: 'Tools', icon: 'üöú' }, 'cart': { name: 'Cart', group: 'Tools', icon: 'üõí' }, 'wheel': { name: 'Wheel', group: 'Tools', icon: '‚ò∏Ô∏è' }, 'boat': { name: 'Boat', group: 'Tools', icon: '‚õµ' }, 'rope': { name: 'Rope', group: 'Materials', icon: 'ü™¢' }, 'leather': { name: 'Leather', group: 'Materials', icon: 'üë¢' }, 'charcoal': { name: 'Charcoal', group: 'Materials', icon: '‚ö´' }, 'gunpowder': { name: 'Gunpowder', group: 'Materials', icon: 'üí•' }, 'cement': { name: 'Cement', group: 'Materials', icon: 'üè¢' }, 'concrete': { name: 'Concrete', group: 'Materials', icon: 'üèõÔ∏è' }, 'wire': { name: 'Wire', group: 'Materials', icon: '„Ä∞Ô∏è' }, 'sword': { name: 'Sword', group: 'Tools', icon: '‚öîÔ∏è' }, 'armor': { name: 'Armor', group: 'Tools', icon: 'üõ°Ô∏è' }, 'blade': { name: 'Blade', group: 'Tools', icon: 'üî™' }, 'wall': { name: 'Wall', group: 'Domestic', icon: 'üß±' }, 'thread': { name: 'Thread', group: 'Materials', icon: 'üßµ' }, 'clothes': { name: 'Clothes', group: 'Domestic', icon: 'üëï' }, 'quill': { name: 'Quill', group: 'Tools', icon: '‚úíÔ∏è' }, 'bullet': { name: 'Bullet', group: 'Tools', icon: '‚ö™' }, 'spear': { name: 'Spear', group: 'Tools', icon: 'üî±' }, 'ship': { name: 'Ship', group: 'Tools', icon: 'üö¢' }, 'bomb': { name: 'Bomb', group: 'Tools', icon: 'üí£' }, 'firearm': { name: 'Firearm', group: 'Tools', icon: 'üî´' }, 'frigate': { name: 'Frigate', group: 'Tools', icon: '‚õµ' },
            // Technology (23)
            'electricity': { name: 'Electricity', group: 'Technology', icon: 'üí°' }, 'lightbulb': { name: 'Light Bulb', group: 'Technology', icon: 'üí°' }, 'computer': { name: 'Computer', group: 'Technology', icon: 'üíª' }, 'radio': { name: 'Radio', group: 'Technology', icon: 'üìª' }, 'television': { name: 'Television', group: 'Technology', icon: 'üì∫' }, 'car': { name: 'Car', group: 'Technology', icon: 'üöó' }, 'airplane': { name: 'Airplane', group: 'Technology', icon: '‚úàÔ∏è' }, 'robot': { name: 'Robot', group: 'Technology', icon: 'ü§ñ' }, 'internet': { name: 'Internet', group: 'Technology', icon: 'üåê' }, 'steamengine': { name: 'Steam Engine', group: 'Technology', icon: 'üöÇ' }, 'clock': { name: 'Clock', group: 'Technology', icon: '‚è∞' }, 'calculator': { name: 'Calculator', group: 'Technology', icon: 'üßÆ' }, 'telephone': { name: 'Telephone', group: 'Technology', icon: '‚òéÔ∏è' }, 'camera': { name: 'Camera', group: 'Technology', icon: 'üì∑' }, 'battery': { name: 'Battery', group: 'Technology', icon: 'üîã' }, 'train': { name: 'Train', group: 'Technology', icon: 'üöÜ' }, 'cyborg': { name: 'Cyborg', group: 'Technology', icon: 'ü§ñ' }, 'website': { name: 'Website', group: 'Technology', icon: 'üï∏Ô∏è' }, 'ai': { name: 'AI', group: 'Technology', icon: 'üí°' }, 'chip': { name: 'Chip', group: 'Technology', icon: 'üíæ' }, 'transistor': { name: 'Transistor', group: 'Technology', icon: '„Ä∞Ô∏è' }, 'vacuumtube': { name: 'Vacuum Tube', group: 'Technology', icon: 'üí°' }, 'radiowave': { name: 'Radio Wave', group: 'Technology', icon: 'üì°' }, 'cellphone': { name: 'Cellphone', group: 'Technology', icon: 'üì±' }, 'motorcycle': { name: 'Motorcycle', group: 'Technology', icon: 'üèçÔ∏è' },
            // Food & Domestic (13)
            'wheat': { name: 'Wheat', group: 'Food', icon: 'üåæ' }, 'flour': { name: 'Flour', group: 'Food', icon: 'üçö' }, 'dough': { name: 'Dough', group: 'Food', icon: 'üç™' }, 'bread': { name: 'Bread', group: 'Food', icon: 'üçû' }, 'milk': { name: 'Milk', group: 'Food', icon: 'ü•õ' }, 'cheese': { name: 'Cheese', group: 'Food', icon: 'üßÄ' }, 'meat': { name: 'Meat', group: 'Food', icon: 'ü•©' }, 'house': { name: 'House', group: 'Domestic', icon: 'üè†' }, 'hut': { name: 'Hut', group: 'Domestic', icon: 'üõñ' }, 'village': { name: 'Village', group: 'Domestic', icon: 'üèòÔ∏è' }, 'fruit': { name: 'Fruit', group: 'Food', icon: 'üçé' }, 'coffee': { name: 'Coffee', group: 'Food', icon: '‚òï' }, 'steak': { name: 'Steak', group: 'Food', icon: 'ü•©' }, 'pie': { name: 'Pie', group: 'Food', icon: 'ü•ß' },
            // Concepts & Magic (26)
            'philosophy': { name: 'Philosophy', group: 'Concepts', icon: 'üß†' }, 'religion': { name: 'Religion', group: 'Concepts', icon: '‚õ™' }, 'myth': { name: 'Myth', group: 'Concepts', icon: 'ü¶Ñ' }, 'magic': { name: 'Magic', group: 'Magic', icon: 'ü™Ñ' }, 'spell': { name: 'Spell', group: 'Magic', icon: 'üìú' }, 'potion': { name: 'Potion', group: 'Magic', icon: 'üß™' }, 'ghost': { name: 'Ghost', group: 'Magic', icon: 'üëª' }, 'undead': { name: 'Undead', group: 'Magic', icon: 'üíÄ' }, 'demon': { name: 'Demon', group: 'Magic', icon: 'üëø' }, 'angel': { name: 'Angel', group: 'Magic', icon: 'üòá' }, 'time': { name: 'Time', group: 'Concepts', icon: '‚è≥' }, 'death': { name: 'Death', group: 'Concepts', icon: 'üíÄ' }, 'love': { name: 'Love', group: 'Concepts', icon: '‚ù§Ô∏è' }, 'music': { name: 'Music', group: 'Concepts', icon: 'üéµ' }, 'knowledge':{ name: 'Knowledge', group: 'Concepts', icon: 'üìö' }, 'void': { name: 'Void', group: 'Concepts', icon: '‚ö´' }, 'light': { name: 'Light', group: 'Concepts', icon: 'üí°' }, 'darkness': { name: 'Darkness', group: 'Concepts', icon: 'üåë' }, 'shadow': { name: 'Shadow', group: 'Concepts', icon: 'üë•' }, 'zombie': { name: 'Zombie', group: 'Magic', icon: 'üßü' }, 'elf': { name: 'Elf', group: 'Magic', icon: 'üßù' }, 'golem': { name: 'Golem', group: 'Magic', icon: 'üóø' }, 'bard': { name: 'Bard', group: 'Magic', icon: 'üé∂' }, 'hero': { name: 'Hero', group: 'Magic', icon: 'ü¶∏' }, 'priest': { name: 'Priest', group: 'Concepts', icon: '‚õ™' }, 'wizard': { name: 'Wizard', group: 'Magic', icon: 'üßô' }, 'elixir': { name: 'Elixir', group: 'Magic', icon: 'üß™' }, 'blackhole': { name: 'Black Hole', group: 'Concepts', icon: '‚ö´' }, 'commandment': { name: 'Commandment', group: 'Concepts', icon: 'üìú' },
        };

        // --- NEW RECIPE STRUCTURE ---
        // Nested object: RECIPES[ingredient1][ingredient2] = result
        // Define only one direction (e.g., air+water, not water+air)
        // Lookup logic will check both directions.
        const RECIPES = {
            air: {
                // air + ...
                air: 'wind',
                cloud: 'sky',
                dust: 'wind', // Alt wind
                earth: 'dust',
                energy: 'storm',
                fire: 'energy',
                lava: 'stone',
                plant: 'seeds',
                steam: 'cloud',
                stone: 'sand',
                water: 'steam',
                wind: 'storm',
            },
            animal: {
                // animal + ...
                animal: 'livestock', // Breeding
                cart: 'chariot', // Needs chariot
                earth: 'animal', // Appears on land
                grass: 'cow',
                human: 'livestock', // Domestication
                tools: 'meat',
                water: 'fish',
            },
            armor: {
                // armor + ...
                human: 'knight', // Needs knight
            },
            bacteria: {
                 // bacteria + ...
                earth: 'mushroom',
                life: 'plankton',
                milk: 'cheese',
                mud: 'worm',
                swamp: 'sulfur', // Needs sulfur
                water: 'plankton',
            },
            battery: {
                lightbulb: 'flashlight', // Needs flashlight
            },
            bird: {
                 // bird + ...
                egg: 'bird',
                fire: 'phoenix',
                human: 'feather',
                metal: 'airplane',
            },
            blade: {
                 // blade + ...
                human: 'blood', // Needs blood
                metal: 'sword',
                stone: 'axe',
                wood: 'knife',
            },
            boat: {
                // boat + ...
                fabric: 'ship',
                wood: 'ship',
            },
            book: { // Needs book element
                 // book + ...
                 // human: 'knowledge', // knowledge makes book
            },
            bread: {
                 // bread + ...
                 // fire: 'toast', // Needs toast
                 // human: 'sandwich', // Needs sandwich
            },
            bricks: {
                bricks: 'wall',
                // cement: 'concrete', // Needs cement
                clay: 'bricks',
            },
            bullet: {
                // firearm: 'shotgun', // Needs firearm/shotgun
            },
            cart: {
                metal: 'car',
                // steamengine: 'train', // Needs steamengine
                wood: 'wheel', // Uses wheel
            },
            cement: { // Needs cement element
                // water: 'concrete',
            },
            charcoal: {
                gunpowder: 'bomb',
            },
            cheese: {
                // dough: 'pizza', // Needs dough/pizza
            },
            chip: {
                electricity: 'calculator',
            },
            clay: {
                // clay + ...
                fire: 'bricks',
                human: 'pottery',
                life: 'golem',
                sand: 'cement', // Recipe for cement
                stone: 'pottery',
                water: 'mud', // Fixed
                wheel: 'pottery',
            },
            clock: {
                human: 'time',
                // sun: 'sundial', // Needs sundial
            },
            cloud: {
                // cloud + ...
                cloud: 'sky',
                electricity: 'storm',
                water: 'rain',
            },
            coal: {
                fire: 'energy',
            },
            cold: {
                steam: 'ice',
                water: 'ice',
                // wind: 'snow', // snow = ice+rain
            },
            computer: {
                computer: 'internet',
                electricity: 'computer', // Requires elec
                human: 'cyborg',
            },
            concrete: { // Needs concrete element
                 // glass: 'skyscraper', // Needs skyscraper
            },
            cow: { // Needs cow element
                 // human: 'milk',
            },
            cyborg: { // Needs cyborg element
                 // human: 'ai',
            },
            darkness: {
                 // earth: 'underworld', // Needs underworld
                 energy: 'void', // Recipe for void
                 light: 'shadow',
            },
            death: {
                 human: 'undead',
                 life: 'zombie',
            },
            demon: {
                 // human: 'corruption', // Needs corruption
            },
            dna: { // Needs dna element
                 // human: 'human', // DNA defines human
            },
            dough: { // Needs dough element
                 fire: 'bread',
                 fruit: 'pie',
            },
            dust: {
                // dust + ...
                // air: 'dust', // no change
                fire: 'gunpowder',
                water: 'mud',
            },
            earth: {
                // earth + ...
                earth: 'stone',
                fire: 'lava',
                // life: 'animal', // Now life+earth
                metal: 'ore', // Needs ore
                moss: 'mushroom',
                plant: 'grass',
                rain: 'plant',
                steam: 'geyser',
                stone: 'mountain', // Needs mountain
                tree: 'seeds',
                water: 'mud',
                worm: 'beetle',
            },
            egg: {
                // egg + ...
                air: 'bird',
                // fire: 'omelette', // Needs omelette
                flour: 'dough',
                sand: 'lizard',
                stone: 'egg', // No change
                swamp: 'lizard',
            },
            electricity: {
                // electricity + ...
                // beast: 'pikachu', // Needs beast :)
                cloud: 'storm',
                computer: 'ai',
                energy: 'electricity', // No change
                glass: 'lightbulb',
                human: 'cyborg',
                metal: 'wire',
                // oxygen: 'ozone', // Needs oxygen/ozone
                storm: 'electricity',
                tools: 'battery',
                vacuumtube: 'radio',
                // water: 'hydrogen', // Needs hydrogen
            },
            elf: { // Needs elf element
                 // metal: 'mithril', // Needs mithril
            },
            energy: {
                // energy + ...
                air: 'storm',
                darkness: 'void', // Moved from darkness+energy
                death: 'ghost',
                energy: 'fire',
                metal: 'electricity',
                sand: 'silicon',
                seeds: 'coffee',
                swamp: 'life', // Classic!
                water: 'geyser',
                wind: 'storm',
            },
            ent: { // Needs ent element
                 // fire: 'charcoal',
            },
            fabric: {
                boat: 'ship', // Moved from boat+fabric
                human: 'clothes',
                // ship: 'frigate', // frigate = ship+wood/fabric
            },
            feather: {
                 human: 'quill', // Alt quill
                 paper: 'quill',
            },
            fire: {
                // fire + ... (excluding air, earth)
                // bird: 'phoenix', // Moved to bird+fire
                clay: 'bricks',
                coal: 'energy',
                // dough: 'bread', // Moved to dough+fire
                dust: 'gunpowder',
                energy: 'sun',
                // fire: 'sun', // Moved to energy+fire
                glass: 'sun',
                // gunpowder: 'explosion', // Needs explosion
                // human: 'corpse', // Moved to human+fire
                ice: 'water',
                lava: 'volcano',
                meat: 'steak',
                metal: 'electricity', // Abstract
                mud: 'bricks',
                // oil: 'energy', // Moved to oil+fire
                // paper: 'ash', // Needs ash
                sand: 'glass',
                seeds: 'coffee',
                sky: 'sun',
                // steamengine: 'train', // Needs steamengine
                stone: 'metal',
                swamp: 'energy',
                tree: 'charcoal',
                water: 'steam',
                wood: 'charcoal',
            },
            firearm: { // Needs firearm element
                // bullet: 'corpse',
            },
            fish: {
                // egg: 'caviar', // Needs caviar
                // human: 'fisherman', // Needs fisherman
                plankton: 'whale',
            },
            flour: {
                water: 'dough',
            },
            flower: {
                human: 'perfume', // Needs perfume
                // moon: 'nightshade', // Needs nightshade
                // sun: 'sunflower', // Needs sunflower
                tree: 'fruit',
                water: 'potion', // Simple potion base
            },
            fruit: {
                // dough: 'pie', // Moved to dough+fruit
            },
            geyser: {
                // steam: 'geyser', // No change
            },
            ghost: {
                 // darkness: 'spectre', // Needs spectre
                 // human: 'medium', // Needs medium
            },
            glass: {
                 metal: 'mirror', // Needs mirror
                 sand: 'clock',
                 // void: 'vacuumtube', // Moved to void+glass
                 // water: 'aquarium', // Needs aquarium
            },
            golem: { // Needs golem element
                 life: 'human', // Abstract animation
                 // metal: 'robot', // Moved to metal+golem?
                 // stone: 'golem', // Moved to stone+golem
                 // swamp: ??
                 // tree: 'ent', // Moved to tree+golem
                 // void: 'demon', // Moved to void+golem
                 // weapon: 'knight', // Moved to weapon+golem
                 // worm: 'centipede', // Needs centipede
                 // zombie: 'abomination', // Needs abomination
            },
            grass: {
                // animal: 'cow', // Moved to animal+grass
                earth: 'grass', // Spreading
                // fire: 'ash', // Needs ash
                // livestock: 'milk', // Moved to livestock+grass
                plant: 'grass', // Spreading
            },
            gunpowder: {
                 charcoal: 'bomb', // Moved from charcoal+gunpowder
                 metal: 'bullet',
                 weapon: 'firearm',
            },
            hammer: { // Needs hammer element
                 metal: 'armor',
                 stone: 'statue', // Needs statue
                 wood: 'mallet', // Needs mallet
            },
            hero: { // Needs hero element
                 // dragon: 'slayer', // Needs dragon/slayer
                 // religion: 'paladin', // Needs paladin
                 weapon: 'sword',
            },
            house: {
                house: 'village',
            },
            human: {
                // ai: 'cyborg', // Needs ai
                // airplane: 'pilot', // Needs airplane/pilot
                animal: 'livestock',
                // armor: 'knight', // Needs armor/knight
                // bacteria: 'sickness', // Needs sickness
                // blade: 'blood', // Needs blood
                // boat: 'sailor', // Needs boat/sailor
                // book: 'knowledge', // Needs book
                clay: 'pottery',
                clock: 'time',
                // clothes: 'human', // No change
                cold: 'corpse', // Needs corpse
                // computer: 'hacker', // Needs computer/hacker
                // cow: 'milk', // Needs cow
                death: 'undead',
                // demon: 'corruption', // Needs demon
                // dna: 'human', // Needs dna
                // doctor: 'hospital', // Needs doctor/hospital
                electricity: 'cyborg',
                energy: 'wizard',
                fire: 'corpse',
                // fish: 'fisherman', // Needs fish/fisherman
                // flower: 'perfume', // Needs flower/perfume
                // forest: 'hunter', // Needs forest/hunter
                fruit: 'juice', // Needs juice
                // ghost: 'medium', // Needs ghost/medium
                // golem: 'wizard', // Needs golem
                // gunpowder: 'demoman', // Needs gunpowder/demoman
                // hammer: 'blacksmith', // Needs hammer/blacksmith
                // hero: 'legend', // Needs hero/legend
                house: 'village',
                human: 'love',
                knowledge: 'philosophy',
                lava: 'corpse',
                leather: 'clothes',
                // library: 'librarian', // Needs library/librarian
                life: 'love',
                // lightbulb: 'idea', // Needs lightbulb/idea
                livestock: 'meat', // Alt meat
                // love: 'family', // Needs family
                magic: 'elf', // Changed from wizard
                // meat: 'carnivore', // Needs carnivore
                metal: 'tools',
                // milk: 'farmer', // Needs milk/farmer
                // money: 'banker', // Needs money/banker
                // moon: 'astronaut', // Needs moon/astronaut
                music: 'bard',
                myth: 'hero',
                // paper: 'book', // Needs paper/book
                philosophy: 'commandment', // Changed path
                // plant: 'farmer', // Needs plant/farmer
                // plow: 'field', // Needs plow/field
                // poison: 'corpse', // Needs poison
                // potion: 'alchemist', // Needs potion/alchemist
                // priest: 'religion', // Moved to priest+human
                rain: 'cold', // Getting wet
                religion: 'priest', // Changed direction
                robot: 'cyborg',
                sand: 'corpse',
                // science: 'scientist', // Needs science/scientist
                // sea: 'swimmer', // Needs sea/swimmer
                seeds: 'farmer',
                sky: 'religion', // Path to religion
                // snake: 'poison', // Needs snake/poison
                // snow: 'skier', // Needs snow/skier
                // sound: 'music', // Needs sound
                // star: 'astronaut', // Needs star/astronaut
                stone: 'hut',
                storm: 'corpse',
                // sun: 'sunburn', // Needs sun/sunburn
                swamp: 'corpse',
                // sword: 'warrior', // Needs sword/warrior
                tools: 'engineer', // Needs engineer
                tree: 'wood',
                // undead: 'necromancer', // Needs undead/necromancer
                // void: 'corpse', // Moved to void+human
                // volcano: 'corpse', // Moved to volcano+human
                // water: 'swimmer', // Needs water/swimmer
                weapon: 'hunter', // Needs hunter
                // wheat: 'farmer', // Needs wheat/farmer
                // wind: 'sailor', // Needs wind/sailor
                // wine: 'drunkard', // Needs wine/drunkard
                // wood: 'carpenter', // Needs wood/carpenter
            },
            hut: {
                stone: 'house',
            },
            ice: {
                 fire: 'water',
                 human: 'cold',
                 rain: 'snow',
                 water: 'ice', // No change
            },
            internet: {
                computer: 'website',
            },
            knowledge: { // Needs knowledge element
                 // book: 'science', // Needs book/science
                 human: 'philosophy',
                 magic: 'spell',
                 // paper: 'book', // Needs paper/book
                 // wall: 'hieroglyphs', // Needs wall/hieroglyphs
            },
            lava: {
                 air: 'stone',
                 earth: 'volcano',
                 // stone: 'magma', // Needs magma
                 water: 'stone',
            },
            leather: {
                 human: 'clothes',
                 tools: 'armor',
            },
            life: {
                 clay: 'golem',
                 // corpse: 'zombie', // Needs corpse
                 death: 'zombie',
                 dna: 'life', // No change
                 dust: 'ghost',
                 earth: 'animal',
                 energy: 'magic', // Path to Magic!
                 fire: 'phoenix',
                 human: 'love',
                 metal: 'robot',
                 // Golem: 'human', // Abstract - moved to Golem+Life
                 stone: 'egg',
                 swamp: 'bacteria',
                 time: 'death', // Alt death
                 tree: 'ent',
                 void: 'death', // Alt death
                 water: 'plankton',
            },
            light: {
                darkness: 'shadow',
            },
            lightbulb: {
                 electricity: 'light',
            },
            livestock: {
                 grass: 'milk',
                 human: 'meat',
            },
            lizard: {
                 earth: 'animal', // Lizard is an animal
            },
            love: {
                 // human: 'family', // Needs family
            },
            magic: {
                 human: 'wizard', // Changed from elf
                 knowledge: 'spell',
                 life: 'elf',
                 metal: 'golem',
                 music: 'bard',
                 potion: 'elixir',
                 // religion: 'priest', // Moved to religion+magic?
            },
            meat: {
                 fire: 'steak',
                 // human: 'carnivore', // Needs carnivore
            },
            metal: {
                 blade: 'sword',
                 earth: 'ore', // Needs ore
                 electricity: 'wire',
                 energy: 'electricity',
                 // fire: 'electricity', // Moved to fire+metal
                 // Golem: 'robot', // Needs golem
                 human: 'tools',
                 steam: 'steamengine',
                 stone: 'hammer',
                 // sun: 'gold', // Needs sun/gold
                 tools: 'weapon',
                 // water: 'rust', // Needs rust
                 wood: 'sword',
            },
            milk: {
                 bacteria: 'cheese',
                 // human: 'cheese', // Moved to human+milk
            },
            moon: {
                 sky: 'night',
                 // sun: 'eclipse', // Needs eclipse
                 // werewolf: 'human', // Needs werewolf
            },
            moss: {
                 earth: 'mushroom',
                 // stone: 'lichen', // Needs lichen
                 // swamp: 'fern', // Needs fern
            },
            mud: {
                 // brick: 'adobe', // Needs brick/adobe
                 // clay: 'mud', // No change
                 fire: 'bricks',
                 grass: 'swamp',
                 // human: 'statue', // Needs statue
                 plant: 'swamp',
                 rain: 'plant',
                 sand: 'clay',
                 // swamp: 'peat', // Needs peat
            },
            mushroom: {
                 // human: 'poison', // Needs poison
                 // tool: 'spores', // Needs tool/spores
            },
            music: {
                 human: 'bard',
                 // reed: 'flute', // Needs reed/flute
                 // wood: 'guitar', // Needs wood/guitar
            },
            night: {
                 // day: 'twilight', // Needs day/twilight
                 sky: 'star',
            },
            oil: { // Needs oil element
                 earth: 'oil',
                 fire: 'energy',
            },
            paper: {
                 feather: 'quill',
                 // human: 'letter', // Needs letter
                 // knowledge: 'book', // Needs knowledge/book
                 // tobacco: 'cigarette', // Needs tobacco/cigarette
            },
            philosophy: {
                 death: 'demon',
                 life: 'angel',
            },
            phoenix: { // Needs phoenix element
                 // fire: 'phoenix', // Reborn
            },
            pie: { // Needs pie element
                 // human: 'dessert', // Needs dessert
            },
            plankton: {
                 fish: 'whale',
                 stone: 'shell',
                 // swamp: 'bacteria', // Moved to swamp+plankton?
                 water: 'plankton', // Spreading
            },
            plant: {
                 air: 'seeds',
                 earth: 'grass',
                 // fire: 'ash', // Needs ash
                 // Golem: 'ent', // Needs golem
                 mud: 'swamp',
                 // paper: 'book', // Needs paper/book
                 // plant: 'garden', // Needs garden
                 rain: 'flower',
                 rope: 'fabric',
                 sand: 'flower', // Cactus
                 stone: 'moss',
                 // sun: 'flower', // Moved to sun+plant
                 swamp: 'reed',
                 time: 'tree',
                 tools: 'thread',
                 water: 'moss',
                 wheel: 'thread',
            },
            plow: { // Needs plow element
                 earth: 'field', // Needs field
            },
            potion: { // Needs potion element
                 // human: 'alchemist', // Needs alchemist
                 magic: 'elixir',
            },
            pottery: { // Needs pottery element
                 // plant: 'vase', // Needs vase
            },
            priest: { // Needs priest element
                 human: 'prayer', // Needs prayer
                 religion: 'faith', // Needs faith
                 stone: 'commandment', // Path to commandment
                 // undead: 'lich', // Needs undead/lich
                 // zombie: 'lich', // Needs zombie/lich
            },
            quill: { // Needs quill element
                 // human: 'writer', // Needs writer
            },
            radio: {
                 electricity: 'television',
                 // star: 'alien', // Needs star/alien
            },
            radiowave: { // Needs radiowave element
                 electricity: 'radio',
                 wire: 'cellphone',
            },
            rain: {
                 earth: 'plant',
                 fire: 'steam',
                 ice: 'snow',
                 mud: 'plant',
                 plant: 'flower',
                 // storm: 'flood', // Needs storm/flood
                 // sun: 'rainbow', // Needs sun/rainbow
            },
            reed: { // Needs reed element
                 // human: 'flute', // Needs flute
                 // paper: 'papyrus', // Needs paper/papyrus
                 // swamp: 'reed', // Spreading
                 tools: 'paper',
            },
            religion: { // Needs religion element
                 death: 'funeral', // Needs funeral
                 human: 'priest',
                 // magic: 'priest', // Using magic?
            },
            robot: { // Needs robot element
                 // ai: 'terminator', // Needs ai :)
                 human: 'cyborg',
                 life: 'ai',
                 // metal: 'robot', // More metal?
            },
            rope: { // Needs rope element
                 // boat: 'rigging', // Needs boat/rigging
                 // human: 'bondage', // :)
                 // knot: 'net', // Needs knot/net
                 // rope: 'net', // Alt net
                 // tool: 'bow', // Needs tool/bow
                 // wood: 'bridge', // Needs wood/bridge
            },
            sand: {
                 // beach: 'dune', // Needs beach/dune
                 // desert: 'dune', // Needs desert/dune
                 // dragon: 'hourglass', // Needs dragon
                 // dust: 'sandstorm', // Needs dust/sandstorm
                 egg: 'lizard',
                 fire: 'glass',
                 glass: 'clock',
                 human: 'corpse',
                 // lizard: 'scorpion', // Needs lizard/scorpion
                 plant: 'seeds', // Alt seeds?
                 // stone: 'sand', // No change
                 // storm: 'sandstorm', // Needs storm/sandstorm
                 swamp: 'clay',
                 // tree: 'palm', // Needs tree/palm
                 water: 'clay',
                 // wind: 'dune', // Needs wind/dune
                 worm: 'beetle',
            },
            sea: {
                 // boat: 'ship', // Moved to boat+sea?
                 fire: 'salt', // Needs salt
                 // fish: 'herring', // Needs fish/herring
                 // human: 'swimmer', // Needs human/swimmer
                 // moon: 'tide', // Needs moon/tide
                 // storm: 'hurricane', // Needs storm/hurricane
                 // sun: 'salt', // Moved to sun+sea
                 wind: 'wave',
            },
            seeds: {
                 earth: 'plant',
                 energy: 'coffee',
                 fire: 'coffee',
                 // human: 'farmer', // Moved to human+seeds
                 life: 'plant',
                 // plant: 'seeds', // Moved to plant+seeds
                 sand: 'tree', // Palm?
                 stone: 'flower', // Crack flower
                 // sun: 'flower', // Moved to sun+seeds
                 swamp: 'tree', // Mangrove?
                 water: 'tree',
            },
            shadow: {
                 // human: 'ninja', // Needs ninja
            },
            shell: { // Needs shell element
                 // human: 'pearl', // Needs pearl
                 // stone: 'limestone', // Needs limestone
            },
            ship: { // Needs ship element
                 // airplane: 'seaplane', // Needs airplane/seaplane
                 fabric: 'frigate',
                 wood: 'frigate',
            },
            silicon: { // Needs silicon element
                 electricity: 'chip',
                 metal: 'transistor',
            },
            sky: {
                 // airplane: 'pilot', // Needs airplane/pilot
                 // bird: 'airplane', // Moved to bird+sky
                 cloud: 'sky', // No change
                 darkness: 'night',
                 fire: 'sun',
                 human: 'religion', // Path to religion
                 moon: 'night',
                 star: 'sun', // Alt sun?
                 stone: 'moon',
                 // sun: 'light', // Moved to sun+sky
            },
            snow: {
                 // human: 'skier', // Needs skier
                 // ice: 'glacier', // Needs ice/glacier
                 // wind: 'blizzard', // Needs wind/blizzard
            },
            spell: { // Needs spell element
                 // book: 'grimoire', // Needs book/grimoire
                 // fire: 'fireball', // Needs fireball
                 human: 'wizard',
                 // ice: 'cone of cold', // Needs ice/cone of cold
                 // Golem: 'wizard', // Needs golem
                 magic: 'spell',
            },
            star: { // Needs star element
                 human: 'astronaut', // Alt astronaut
                 sky: 'night',
                 // telescope: 'galaxy', // Needs telescope/galaxy
                 // void: 'blackhole', // Moved to void+star
            },
            steak: { // Needs steak element
                 // human: 'barbecue', // Needs barbecue
            },
            steam: {
                 air: 'cloud', // Moved to air+steam
                 earth: 'geyser',
                 // engine: 'steamengine', // Needs engine
                 // geyser: 'sulfur', // Needs geyser/sulfur
                 metal: 'steamengine',
                 // water: 'geyser', // Moved to water+steam
                 // wood: 'sauna', // Needs wood/sauna
            },
            stone: {
                 air: 'sand',
                 blade: 'axe',
                 clay: 'pottery',
                 earth: 'stone', // No change
                 egg: 'egg', // No change
                 fire: 'metal',
                 // Golem: 'golem', // Needs golem
                 human: 'hut',
                 // lava: 'obsidian', // Needs lava/obsidian
                 life: 'golem',
                 metal: 'hammer',
                 // moss: 'lichen', // Needs moss/lichen
                 plankton: 'shell',
                 // sand: 'stone', // No change
                 // shell: 'limestone', // Needs shell/limestone
                 stone: 'wall',
                 tools: 'plow',
                 water: 'sand',
                 // wheat: 'flour', // Moved to wheat+stone
                 // wood: 'axe', // Moved to wood+stone
            },
            storm: {
                 // air: 'tornado', // Needs tornado
                 // bird: 'thunderbird', // Needs thunderbird
                 electricity: 'electricity',
                 energy: 'electricity',
                 // sand: 'sandstorm', // Needs sand/sandstorm
                 // water: 'typhoon', // Needs water/typhoon
            },
            sun: {
                 earth: 'desert', // Needs desert
                 energy: 'sun', // No change
                 fire: 'sun', // No change
                 // flower: 'sunflower', // Needs flower/sunflower
                 // glass: 'sunglasses', // Needs glass/sunglasses
                 // Golem: 'angel', // Needs golem
                 // human: 'sunburn', // Needs human/sunburn
                 ice: 'water',
                 life: 'flower',
                 // moon: 'eclipse', // Needs moon/eclipse
                 plant: 'flower',
                 // rain: 'rainbow', // Needs rain/rainbow
                 sea: 'salt', // Needs salt
                 sky: 'light',
                 // tree: 'fruit', // Moved to tree+sun?
                 // vampire: 'ash', // Needs vampire/ash
                 water: 'steam',
            },
            swamp: {
                 bacteria: 'sulfur', // Needs sulfur
                 // dragon: 'hydra', // Needs dragon/hydra
                 egg: 'lizard',
                 energy: 'life',
                 fire: 'energy',
                 grass: 'reed', // Alt reed
                 life: 'bacteria',
                 moss: 'fern', // Needs fern
                 // mud: 'peat', // Needs mud/peat
                 plant: 'reed',
                 sand: 'clay',
                 // tree: 'mangrove', // Needs tree/mangrove
                 // worm: 'snake', // Needs worm/snake
            },
            sword: { // Needs sword element
                 // human: 'warrior', // Needs warrior
                 // Golem: 'knight', // Needs golem/knight
            },
            television: {
                 // book: 'email', // Needs book :)
                 radio: 'movie', // Needs movie
            },
            thread: { // Needs thread element
                 // human: 'fabric', // Moved to human+thread?
                 // needle: 'clothes', // Needs needle
                 thread: 'rope',
            },
            time: { // Needs time element
                 clock: 'time', // Measuring
                 // glass: 'hourglass', // Moved to glass+time?
                 human: 'corpse',
                 life: 'death',
                 sand: 'hourglass', // Alt hourglass
                 // water: 'erosion', // Needs erosion
            },
            tools: { // Needs tools element
                 animal: 'meat',
                 // boat: 'sailor', // Needs boat/sailor
                 // book: 'typewriter', // Needs book/typewriter
                 // clay: 'sculpture', // Needs clay/sculpture
                 // clothes: 'tailor', // Needs clothes/tailor
                 // corpse: 'butcher', // Needs corpse/butcher
                 earth: 'field', // Needs field
                 electricity: 'battery',
                 // fabric: 'sewing machine', // Needs fabric/sewing machine
                 // farmer: 'plow', // Needs farmer/plow
                 // fire: 'forge', // Needs fire/forge
                 // fish: 'fishing rod', // Needs fish/fishing rod
                 // glass: 'lens', // Needs glass/lens
                 human: 'engineer', // Needs engineer
                 // ice: 'ice skates', // Needs ice/ice skates
                 leather: 'armor',
                 // Golem: 'robot', // Needs golem
                 // meat: 'knife', // Moved to meat+tools?
                 metal: 'armor', // Alt armor
                 // paper: 'origami', // Needs paper/origami
                 plant: 'thread',
                 reed: 'paper',
                 // rope: 'bow', // Moved to rope+tools
                 // sand: 'hourglass', // Moved to sand+tools?
                 stone: 'plow',
                 // sun: 'sundial', // Needs sun/sundial
                 // swamp: 'boat', // Raft?
                 tools: 'hammer',
                 tree: 'wood',
                 // water: 'well', // Needs water/well
                 // wheat: 'scythe', // Needs wheat/scythe
                 wood: 'wheel',
            },
            train: { // Needs train element
                 // human: 'engineer', // Needs engineer
            },
            transistor: { // Needs transistor element
                 transistor: 'chip',
            },
            tree: {
                 axe: 'wood',
                 earth: 'seeds',
                 // ent: 'ent', // Needs ent
                 fire: 'charcoal',
                 // fruit: 'tree', // Tree produces fruit
                 human: 'wood',
                 life: 'ent',
                 // Golem: 'ent', // Needs golem
                 // moss: 'tree', // Moss grows on tree
                 // plant: 'tree', // Plant grows
                 // sand: 'palm', // Needs palm
                 // seeds: 'tree', // Seed grows
                 // swamp: 'mangrove', // Needs swamp/mangrove
                 // time: 'wood', // Petrified?
                 tools: 'wood', // Alt wood
                 water: 'boat',
                 // wind: 'leaf', // Needs wind/leaf
            },
            undead: { // Needs undead element
                 death: 'undead', // No change
                 human: 'necromancer', // Needs necromancer
                 life: 'death', // Cannot be cured simply?
                 // Golem: 'lich', // Needs golem/lich
                 // priest: 'zombie', // Moved to priest+undead?
            },
            vacuumtube: { // Needs vacuumtube element
                 electricity: 'radio',
            },
            village: { // Needs village element
                 human: 'community', // Needs community
                 // Golem: 'watchtower', // Needs golem/watchtower
                 // undead: 'ghost town', // Needs undead/ghost town
                 village: 'city', // Needs city
                 // wall: 'fortress', // Needs wall/fortress
            },
            void: { // Needs void element
                 darkness: 'void', // No change
                 electricity: 'radiowave',
                 energy: 'blackhole',
                 glass: 'vacuumtube',
                 // Golem: 'demon', // Needs golem
                 human: 'corpse', // Death in void
                 life: 'death',
                 // light: 'star', // Light in void?
                 star: 'blackhole',
            },
            volcano: {
                 // ash: 'eruption', // Needs ash/eruption
                 energy: 'ash', // Needs ash
                 // geyser: 'sulfur', // Needs geyser/sulfur
                 // pressure: 'eruption', // Needs pressure/eruption
                 // rain: 'acid rain', // Needs rain/acid rain
                 // sea: 'island', // Needs sea/island
            },
            wall: { // Needs wall element
                 house: 'fortress', // Needs fortress
                 // human: 'prisoner', // Needs prisoner
                 // village: 'fortress', // Moved to village+wall
            },
            water: {
                 // air: 'steam', // Moved to air+water
                 bacteria: 'plankton',
                 // boat: 'paddle', // Needs boat/paddle
                 // cement: 'concrete', // Moved to cement+water
                 clay: 'mud', // Alt mud
                 // cold: 'ice', // Moved to cold+water
                 dust: 'mud',
                 earth: 'mud',
                 // electricity: 'hydrogen', // Needs hydrogen
                 energy: 'geyser',
                 // fire: 'steam', // Moved to fire+water
                 // fish: 'roe', // Needs fish/roe
                 flour: 'dough',
                 // glass: 'aquarium', // Needs glass/aquarium
                 // human: 'swimmer', // Needs human/swimmer
                 // ice: 'water', // Moved to ice+water
                 lava: 'stone',
                 life: 'potion',
                 // Golem: 'fountain', // Needs golem/fountain
                 // metal: 'rust', // Needs metal/rust
                 // pipe: 'plumbing', // Needs pipe/plumbing
                 plankton: 'plankton', // Spreading
                 plant: 'moss',
                 rain: 'sea',
                 sand: 'clay',
                 // sea: 'sea', // No change
                 seeds: 'tree',
                 // ship: 'submarine', // Needs ship/submarine
                 sky: 'rain',
                 steam: 'geyser', // Alt geyser
                 stone: 'sand',
                 // sun: 'steam', // Moved to sun+water
                 // swamp: 'swamp', // No change
                 // time: 'erosion', // Needs time/erosion
                 tree: 'boat',
                 water: 'sea',
                 // wheat: 'beer', // Needs wheat/beer
                 // wind: 'wave', // Moved to wind+water
                 // wood: 'boat', // Moved to wood+water
            },
            wave: { // Needs wave element
                 // beach: 'surfboard', // Needs beach/surfboard
                 earth: 'beach', // Needs beach
                 // human: 'surfer', // Needs human/surfer
                 // wind: 'storm', // Moved to wind+wave
            },
            weapon: { // Needs weapon element
                 gunpowder: 'firearm',
                 human: 'corpse',
                 // Golem: 'knight', // Needs golem/knight
                 // poison: 'poisoned weapon', // Needs poison
            },
            website: { // Needs website element
                 // human: 'blogger', // Needs blogger
            },
            wheat: { // Needs wheat element
                 // fire: 'bread', // Moved to fire+wheat? (unlikely)
                 // human: 'farmer', // Moved to human+wheat
                 // Golem: 'scarecrow', // Needs golem/scarecrow
                 stone: 'flour',
                 // water: 'beer', // Needs beer
            },
            wheel: { // Needs wheel element
                 cart: 'car',
                 metal: 'car',
                 // Golem: 'transformer', // Needs golem :)
                 wood: 'cart',
            },
            wind: {
                 air: 'wind', // No change
                 // bird: 'airplane', // Moved to bird+wind
                 earth: 'dust',
                 energy: 'storm',
                 fire: 'energy',
                 // Golem: 'windmill', // Needs golem/windmill
                 ice: 'cold',
                 // lava: 'ash', // Needs lava/ash
                 // leaf: 'fan', // Needs leaf/fan
                 // sail: 'sailboat', // Needs sail/sailboat
                 sand: 'dune', // Needs dune
                 seeds: 'dandelion', // Needs dandelion
                 // storm: 'hurricane', // Moved to storm+wind?
                 // tree: 'leaf', // Moved to tree+wind
                 water: 'wave',
                 // wheel: 'windmill', // Moved to wheel+wind
            },
            wire: { // Needs wire element
                 electricity: 'lightbulb', // Simplified path?
                 // internet: 'wifi', // Needs internet/wifi
                 radiowave: 'cellphone',
                 // sound: 'telephone', // Needs sound
            },
            wizard: { // Needs wizard element
                 // book: 'spell', // Needs book
                 // Golem: 'apprentice', // Needs golem/apprentice
                 // human: 'elf', // Teaches human?
                 magic: 'spell',
            },
            wood: {
                 boat: 'ship',
                 // book: 'bookshelf', // Needs book/bookshelf
                 // cart: 'carriage', // Needs cart/carriage
                 earth: 'tree',
                 fire: 'charcoal',
                 // Golem: 'pinocchio', // Needs golem :)
                 // hammer: 'mallet', // Needs hammer/mallet
                 human: 'carpenter', // Needs carpenter
                 metal: 'sword',
                 // music: 'guitar', // Needs music/guitar
                 // paper: 'cardboard', // Needs paper/cardboard
                 // pressure: 'paper', // Needs pressure
                 // rope: 'bridge', // Needs rope/bridge
                 // sand: 'sandpaper', // Needs sand/sandpaper
                 stone: 'axe',
                 // swamp: 'peat', // Needs swamp/peat
                 // thread: 'loom', // Needs thread/loom
                 tools: 'axe',
                 // water: 'boat', // Moved to water+wood
                 wheel: 'cart',
                 // wind: 'flute', // Needs wind/flute
                 // worm: 'termite', // Needs worm/termite
            },
            worm: {
                 air: 'butterfly',
                 earth: 'beetle',
                 // Golem: 'centipede', // Needs golem/centipede
                 sand: 'beetle',
                 // swamp: 'snake', // Needs swamp/snake
            },
            zombie: { // Needs zombie element
                 // corpse: 'ghoul', // Needs corpse/ghoul
                 death: 'zombie', // No change
                 // electricity: 'frankenstein', // Needs electricity/frankenstein
                 // Golem: 'abomination', // Needs golem/abomination
                 life: 'human', // Curing?
                 // priest: 'lich', // Needs priest/lich
                 // zombie: 'horde', // Needs horde
            },
            // Add recipes for elements that were only results before
            // e.g., if 'mountain' is needed as ingredient, add 'mountain': {}
            mountain: {}, // Needs mountain element
            ore: {}, // Needs ore element
            blood: {}, // Needs blood element
            corpse: {}, // Needs corpse element
            chariot: {}, // Needs chariot element
            knight: {}, // Needs knight element
            sulfur: {}, // Needs sulfur element
            flashlight: {}, // Needs flashlight element
            toast: {}, // Needs toast element
            sandwich: {}, // Needs sandwich element
            pizza: {}, // Needs pizza element
            concrete: {}, // Needs concrete element
            skyscraper: {}, // Needs skyscraper element
            sundial: {}, // Needs sundial element
            underworld: {}, // Needs underworld element
            // ... etc for all previously "result-only" elements used as ingredients
        };


        // --- Game State ---
        let discoveredElements = new Set(['fire', 'water', 'earth', 'air']);
        let selectedElements = [];
        let totalElements = Object.keys(ALL_ELEMENTS).length;
        let feedbackTimeout = null;
        let hintTimeout = null;

        // --- DOM References ---
        const elementsListDiv = document.getElementById('elements-list');
        const slot1Div = document.getElementById('slot1');
        const slot2Div = document.getElementById('slot2');
        const feedbackDiv = document.getElementById('feedback');
        const resetButton = document.getElementById('reset-button');
        const hintButton = document.getElementById('hint-button');
        const progressCounterSpan = document.getElementById('progress-counter');
        const searchBar = document.getElementById('search-bar');

        // --- Reachability Check Function ---
        function checkReachability() {
            console.log("--- Starting Reachability Check ---");
            const baseElements = ['fire', 'water', 'earth', 'air'];
            const reachable = new Set(baseElements);
            let newlyDiscovered = true;
            let iterations = 0;
            const maxIterations = Object.keys(ALL_ELEMENTS).length * 3; // Increased safety break

            while (newlyDiscovered && iterations < maxIterations) {
                newlyDiscovered = false;
                iterations++;
                // Iterate through the new RECIPES structure
                for (const e1 in RECIPES) {
                    if (!reachable.has(e1)) continue; // Skip if primary ingredient not reachable

                    for (const e2 in RECIPES[e1]) {
                        if (!reachable.has(e2)) continue; // Skip if secondary ingredient not reachable

                        const resultId = RECIPES[e1][e2];

                        if (!reachable.has(resultId)) { // Check if result is new
                            if (ALL_ELEMENTS[resultId]) {
                                reachable.add(resultId);
                                newlyDiscovered = true;
                                // console.log(`  Discovered: ${resultId} from ${e1} + ${e2}`);
                            } else {
                                console.warn(`Recipe ${e1}+${e2} produces undefined element: ${resultId}`);
                            }
                        }
                    }
                }
             }

             if (iterations >= maxIterations) {
                console.warn("Reachability check hit max iterations. Possible infinite loop or very complex/broken dependencies.");
            }

            const allElementIds = new Set(Object.keys(ALL_ELEMENTS));
            const unreachable = [];
            allElementIds.forEach(id => { if (!reachable.has(id)) unreachable.push(id); });

            if (unreachable.length > 0) {
                console.warn("Unreachable elements found:", unreachable.length);
                console.warn(unreachable.map(id => `${id} (${ALL_ELEMENTS[id]?.name || 'N/A'})`).join(', '));
            } else {
                console.log("All elements are reachable!");
            }

            // Check for recipe errors (ingredients/results not in ALL_ELEMENTS)
            let recipeErrors = false;
             for (const e1 in RECIPES) {
                 if (!ALL_ELEMENTS[e1]) { console.error(`Recipe key '${e1}' not defined in ALL_ELEMENTS.`); recipeErrors = true; }
                 for (const e2 in RECIPES[e1]) {
                     if (!ALL_ELEMENTS[e2]) { console.error(`Recipe key '${e2}' (in ${e1}) not defined in ALL_ELEMENTS.`); recipeErrors = true; }
                     const resultId = RECIPES[e1][e2];
                     if (!ALL_ELEMENTS[resultId]) { console.error(`Recipe result '${resultId}' (from ${e1}+${e2}) not defined in ALL_ELEMENTS.`); recipeErrors = true; }
                 }
             }
             if (!recipeErrors) { console.log("Recipe ingredient/result check passed."); }

            console.log(`--- Reachability Check Complete (${reachable.size} elements reachable) ---`);
            return reachable;
        }
        // --- End Reachability Check ---


        // --- Core Game Logic Functions ---
        function getElementData(elementId) { return ALL_ELEMENTS[elementId]; }

        function renderElements() { /* Function remains the same as previous version */
            elementsListDiv.innerHTML = ''; const groupedElements = {}; const searchTerm = searchBar.value.toLowerCase().trim();
            const filteredDiscovered = Array.from(discoveredElements).filter(id => { const element = getElementData(id); return element && element.name.toLowerCase().includes(searchTerm); });
            filteredDiscovered.forEach(id => { const element = getElementData(id); if (!element) return; if (!groupedElements[element.group]) groupedElements[element.group] = []; groupedElements[element.group].push(id); });
            const groupOrder = ['Basic', 'Natural', 'Weather', 'Life', 'Materials', 'Tools', 'Technology', 'Food', 'Domestic', 'Concepts', 'Magic'];
            const sortedGroups = Object.keys(groupedElements).sort((a, b) => { let indexA = groupOrder.indexOf(a); let indexB = groupOrder.indexOf(b); if (indexA === -1) indexA = Infinity; if (indexB === -1) indexB = Infinity; if (indexA !== indexB) return indexA - indexB; return a.localeCompare(b); });
            if (filteredDiscovered.length === 0 && searchTerm !== '') { elementsListDiv.innerHTML = `<p style="text-align:center; margin-top: 20px; font-style: italic;">No matching elements found.</p>`; } else if (filteredDiscovered.length === 0 && discoveredElements.size > 0 && searchTerm === '') { elementsListDiv.innerHTML = `<p style="text-align:center; margin-top: 20px; font-style: italic;">No elements discovered yet.</p>`; }
            sortedGroups.forEach(groupName => { const groupContainer = document.createElement('div'); groupContainer.classList.add('element-group'); const groupTitle = document.createElement('h3'); groupTitle.textContent = groupName; groupContainer.appendChild(groupTitle); const groupDiv = document.createElement('div'); groupDiv.classList.add('elements-in-group'); groupedElements[groupName].sort((a, b) => getElementData(a).name.localeCompare(getElementData(b).name)); groupedElements[groupName].forEach(id => { const element = getElementData(id); if (!element) return; const iconDiv = document.createElement('div'); iconDiv.classList.add('element-icon'); iconDiv.dataset.id = id; iconDiv.title = element.name; const iconDisplay = document.createElement('span'); iconDisplay.classList.add('icon-display'); iconDisplay.textContent = element.icon || '?'; const iconName = document.createElement('span'); iconName.classList.add('icon-name'); iconName.textContent = element.name; iconDiv.appendChild(iconDisplay); iconDiv.appendChild(iconName); iconDiv.onclick = () => handleElementClick(id); groupDiv.appendChild(iconDiv); }); groupContainer.appendChild(groupDiv); elementsListDiv.appendChild(groupContainer); });
            updateProgress(); highlightSelectedIcons(); clearHintHighlight();
        }

        function updateProgress() { /* Function remains the same as previous version */
            progressCounterSpan.textContent = `${discoveredElements.size}/${totalElements}`; hintButton.disabled = (discoveredElements.size === totalElements);
            if (discoveredElements.size === totalElements) { setFeedback("Congratulations! You've discovered all elements!", "success"); }
        }

        function handleElementClick(elementId) { /* Function remains the same as previous version */
            clearHintHighlight(); if (selectedElements.length < 2) { selectedElements.push(elementId); } else { selectedElements[1] = elementId; } updateSlots(); highlightSelectedIcons();
            if (selectedElements.length === 2) { attemptCombination(); } else { setFeedback("Select one more element.", ""); }
        }

        function updateSlots() { /* Function remains the same as previous version */
            const updateSingleSlot = (slotDiv, elementId) => { if (elementId) { const element = getElementData(elementId); if (!element) { slotDiv.textContent = '?'; slotDiv.classList.remove('filled'); slotDiv.title = 'Error'; return; } slotDiv.innerHTML = `<span class="icon-display">${element.icon || '?'}</span>`; slotDiv.classList.add('filled'); slotDiv.title = element.name; } else { slotDiv.textContent = '?'; slotDiv.classList.remove('filled'); slotDiv.title = ''; } };
            updateSingleSlot(slot1Div, selectedElements[0]); updateSingleSlot(slot2Div, selectedElements[1]);
        }

         function highlightSelectedIcons() { /* Function remains the same as previous version */
             document.querySelectorAll('.element-icon.selected').forEach(icon => icon.classList.remove('selected'));
             selectedElements.forEach((id) => { document.querySelectorAll(`.element-icon[data-id="${id}"]`).forEach(icon => { if(icon.closest('#elements-list')) icon.classList.add('selected'); }); });
         }

        // --- UPDATED attemptCombination ---
        function attemptCombination() {
            if (selectedElements.length !== 2) return;

            const el1Id = selectedElements[0];
            const el2Id = selectedElements[1];

            // Check both combinations: e1+e2 and e2+e1
            let resultId = RECIPES[el1Id]?.[el2Id] ?? RECIPES[el2Id]?.[el1Id] ?? null;
            // (Uses optional chaining ?. and nullish coalescing ?? )

            let needsRender = (searchBar.value.trim() !== '');

            if (resultId && ALL_ELEMENTS[resultId]) {
                const newElement = getElementData(resultId);
                 if (!newElement) { setFeedback("Error in game data.", "fail"); setTimeout(resetSelection, 1200); return; }

                if (!discoveredElements.has(resultId)) {
                    discoveredElements.add(resultId);
                    needsRender = true;
                    const el1Name = getElementData(el1Id).name;
                    const el2Name = getElementData(el2Id).name;
                    setFeedback(`Success! ${el1Name} + ${el2Name} = ${newElement.name}!`, "success");

                     setTimeout(() => { // Visual feedback for new icon
                        const newIcon = document.querySelector(`.element-icon[data-id="${resultId}"]`);
                        if (newIcon) {
                            newIcon.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
                            newIcon.style.transform = 'scale(1.2)'; newIcon.style.boxShadow = '0 0 15px 5px #28a745';
                            setTimeout(() => { newIcon.style.transform = 'scale(1)'; newIcon.style.boxShadow = ''; }, 300);
                        }
                     }, needsRender ? 150 : 50);
                     setTimeout(resetSelection, 800);
                } else {
                     setFeedback(`You already know ${newElement.name}.`, "");
                     setTimeout(resetSelection, 1200);
                }
            } else {
                // No recipe found for either combination
                setFeedback("Nothing happened.", "fail");
                 setTimeout(resetSelection, 1200);
            }
            if (needsRender) { setTimeout(renderElements, 100); } else { updateProgress(); }
        }
        // --- END UPDATED attemptCombination ---


        function setFeedback(message, type = "") { /* Function remains the same as previous version */
             if (feedbackTimeout) clearTimeout(feedbackTimeout); feedbackDiv.textContent = message; feedbackDiv.className = 'feedback'; if (type) feedbackDiv.classList.add(type);
             if (!type) { feedbackTimeout = setTimeout(() => { if(feedbackDiv.textContent === message && !feedbackDiv.classList.contains('hint') && !feedbackDiv.classList.contains('success') && !feedbackDiv.classList.contains('fail')) { feedbackDiv.textContent = 'Select element(s).'; feedbackDiv.className = 'feedback'; } }, 3500); }
         }

        function resetSelection() { selectedElements = []; updateSlots(); highlightSelectedIcons(); }
        function clearHintHighlight() { /* Function remains the same as previous version */
            if (hintTimeout) clearTimeout(hintTimeout); document.querySelectorAll('.element-icon.hint-active').forEach(icon => { icon.classList.remove('hint-active'); icon.style.animation = ''; });
         }

         // --- UPDATED provideHint ---
         function provideHint() {
            clearHintHighlight(); resetSelection(); searchBar.value = ''; renderElements();
            setFeedback("Thinking...", "");
            const possibleHints = []; const discoveredArray = Array.from(discoveredElements);

            // Iterate through the new recipe structure
            for (const e1 of discoveredArray) {
                 if (!RECIPES[e1]) continue; // Skip if element has no recipes defined *under its key*

                 for (const e2 of discoveredArray) {
                     // Check recipe e1 + e2
                     const resultId = RECIPES[e1]?.[e2];

                     if (resultId && ALL_ELEMENTS[resultId] && !discoveredElements.has(resultId)) {
                        // Found a valid, undiscovered recipe
                         // Avoid adding duplicate hints (e.g., air+water and water+air if both were defined)
                         const exists = possibleHints.some(hint =>
                             (hint.e1 === e1 && hint.e2 === e2) || (hint.e1 === e2 && hint.e2 === e1)
                         );
                         if (!exists) {
                             possibleHints.push({ e1, e2, result: resultId });
                         }
                     }
                 }
            }


            if (possibleHints.length > 0) {
                let hint = possibleHints[Math.floor(Math.random() * possibleHints.length)];
                const el1Name = getElementData(hint.e1).name, el2Name = getElementData(hint.e2).name;
                setFeedback(`Hint: Try ${el1Name} + ${el2Name}...`, "hint");
                const icon1 = document.querySelector(`.element-icon[data-id="${hint.e1}"]`);
                const icon2 = document.querySelector(`.element-icon[data-id="${hint.e2}"]`);
                if (icon1) { icon1.classList.add('hint-active'); icon1.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
                 if (hint.e1 !== hint.e2 && icon2) { setTimeout(() => icon2.classList.add('hint-active'), 50); }
                 else if (icon2) { /* Same element */ }
                hintTimeout = setTimeout(clearHintHighlight, 5000);
            } else {
                if (discoveredElements.size === totalElements) { setFeedback("You've discovered everything!", "success"); hintButton.disabled = true; }
                else { setFeedback("No new combinations found.", ""); }
            }
        }
         // --- END UPDATED provideHint ---


        // --- Initialization ---
        resetButton.onclick = () => { clearHintHighlight(); resetSelection(); setFeedback("Selection cleared.", ""); };
        hintButton.onclick = provideHint;
        searchBar.oninput = () => { clearHintHighlight(); renderElements(); };

        totalElements = Object.keys(ALL_ELEMENTS).length;
        renderElements();
        setFeedback("Welcome! Select two elements.", "");
        console.log(`Doodle Book Clone Initialized. ${totalElements} elements loaded. Run checkReachability() in console to verify connections.`);
        if (discoveredElements.size === totalElements) { hintButton.disabled = true; }

        // Optional: Run check on load
        // checkReachability();

    </script>

</body>
</html>